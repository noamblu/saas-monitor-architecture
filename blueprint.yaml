name: SaaS-Monitor-Architecture
version: 1.1.0
description: >-
  A modular SaaS monitoring architecture using AWS EventBridge Pipes, Scheduler,
  Lambda, and SQS. It triggers a mock SaaS API check on a schedule, processes
  the response using a user-provided receiver (Lambda).

inputs:
  aws_region:
    type: string
    description: AWS Region to deploy resources
    default: eu-central-1
  aws_profile:
    type: string
    description: AWS Profile to use for authentication
    default: sandbox
  saas_name:
    type: string
    description: The name of the SaaS application
    default: noam-saas
  
  # Authentication
  auth_type:
    type: string
    description: "Authentication type: API_KEY, BASIC, OAUTH, or NONE"
    default: API_KEY
  api_key_config:
    type: object
    description: |
      Configuration for API_KEY auth.
      Fields:
        - key: (string) The API key header name
name: SaaS-Monitor-Architecture
version: 1.1.0
description: >-
  A modular SaaS monitoring architecture using AWS EventBridge Pipes, Scheduler,
  Lambda, and SQS. It triggers a mock SaaS API check on a schedule, processes
  the response using a user-provided receiver (Lambda).

inputs:
  aws_region:
    type: string
    default: "eu-central-1"
  saas_name:
    type: string
    default: "noam-saas"
  target_url:
    type: string
    default: "https://api.example.com/health"
  event_bus_name:
    type: string
    default: "ops-main-cust-bus"
  auth_type:
    type: string
    default: "API_KEY"
    options: ["API_KEY", "BASIC", "OAUTH", "NONE"]
  api_key_config:
    type: object
    sensitive: true
  basic_auth_config:
    type: object
    sensitive: true
  oauth_config:
    type: object
    sensitive: true

architecture:
  modules:
    - name: saas_poller_lambda
      type: lambda
      description: "Lambda that polls data from SaaS API and puts events to EventBridge"
    - name: monitor_schedule
      type: scheduler
      description: "EventBridge Scheduler to trigger the poller"
    - name: api_destination
      type: api-destination
      description: "API Destination and Connection for SaaS API"
    - name: mock_saas_lambda
      type: lambda
      description: "Mock SaaS API (for testing)"

outputs:
  saas_poller_lambda_arn:
    description: "ARN of the SaaS Poller Lambda"
  api_destination_arn:
    description: "ARN of the API Destination"
  mock_saas_url:
    description: "URL of the Mock SaaS API"
