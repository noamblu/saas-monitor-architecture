name: SaaS-Monitor-Architecture
version: 1.2.0
description: >-
  A modular SaaS monitoring architecture using AWS EventBridge Scheduler, Lambda,
  and EventBridge Bus. It triggers a SaaS Poller Lambda on a schedule, which
  fetches data from a SaaS API and publishes events to a dedicated SaaS Event Bus,
  forwarding them to a central operations bus.

inputs:
  aws_region:
    type: string
    default: "eu-central-1"
  aws_profile:
    type: string
    default: "sandbox"
  saas_name:
    type: string
    default: "noam-saas"
  target_url:
    type: string
    default: "https://api.example.com/health"
  ops_main_events_bus_name:
    type: string
    default: "operational-main-events-bus"
  auth_config:
    type: object
    description: |
      Authentication configuration.
      Fields:
        - mode: (string) API_KEY, BASIC, OAUTH, NONE
        - api_key: (object) { key, value }
        - basic: (object) { username, password }
        - oauth: (object) { authorization_endpoint, http_method, client_parameters, oauth_http_parameters }
  api_destination_name:
    type: string
    description: "Name of the API Destination (optional)"
  connection_name:
    type: string
    description: "Name of the Connection (optional)"

architecture:
  modules:
    - name: security_group
      type: security-group
      description: "Security Group for Lambda functions"
    - name: api_destination
      type: api-destination
      description: "API Destination and Connection for SaaS API"
    - name: event_bus
      type: event-bridge-bus
      description: "Dedicated SaaS Event Bus with forwarding rules"
    - name: schema_registry
      type: schema-registry
      description: "EventBridge Schema Registry and Schemas"
    - name: saas_poller_lambda
      type: lambda
      description: "Lambda that polls data from SaaS API and puts events to EventBridge"
    - name: monitor_schedule
      type: scheduler
      description: "EventBridge Scheduler to trigger the poller"

outputs:
  saas_poller_lambda_arn:
    description: "ARN of the SaaS Poller Lambda"
  api_destination_arn:
    description: "ARN of the API Destination"
  saas_event_bus_arn:
    description: "ARN of the dedicated SaaS Event Bus"
  lambda_security_group_id:
    description: "The ID of the Security Group created for Lambda functions"
